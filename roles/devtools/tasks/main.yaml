- name: install liquidprompt
  git: >
    repo=https://github.com/nojhan/liquidprompt.git
    dest={{ localinstallation }}/liquidprompt
    version={{ liquidprompt_version }}

- name: install autoenv
  git: >
    repo=https://github.com/kennethreitz/autoenv.git
    dest={{ localinstallation }}/autoenv
    version={{ autoenv_version }}

- name: install local ansible-docker
  git: >
    repo=https://github.com/ulrichSchreiner/ansible-docker.git
    dest={{ localinstallation }}/ansible-docker
    version={{ localansible_version }}

- name: create ansible shortcuts
  file: src=/usr/local/ansible-docker/ansible dest=/usr/local/bin/{{item}} mode=0755 state=link
  with_items:
    - ansible
    - ansible-playbook
    - ansible-vault
    - ansible-doc
    - ansible-pull
    - ansible-galaxy

- name: create local bin directory
  file: path={{localinstallation}}/bin state=directory mode=0755

- name: install docker-compose as a direct command
  get_url: >
    url=https://github.com/docker/compose/releases/download/{{docker_compose_version}}/docker-compose-{{ansible_system}}-{{ansible_machine}}
    dest={{localinstallation}}/bin/docker-compose
    mode=0755
    force=yes

- name: install docker-machine as a direct command
  get_url: >
    url=https://github.com/docker/machine/releases/download/{{docker_machine_version}}/docker-machine-{{ansible_system}}-{{ansible_machine}}
    dest={{localinstallation}}/bin/docker-machine
    mode=0755
    force=yes


- name: create local bfg directory
  file: path={{localinstallation}}/bfg state=directory mode=0755

- name: install bfg a jar
  get_url: >
    url=http://repo1.maven.org/maven2/com/madgag/bfg/{{bfg_version}}/bfg-{{bfg_version}}.jar
    dest={{localinstallation}}/bfg/bfg-{{bfg_version}}.jar
    mode=0755
    force=yes

- name: install bfg command
  template: src=bfg.j2 dest={{localinstallation}}/bin/bfg mode=0755

- name: create local micro directory
  file: path={{localinstallation}}/micro-{{micro_editor_version}} state=directory mode=0755
  register: micro_directory

- name: download microeditor
  get_url: >
    url=https://github.com/zyedidia/micro/releases/download/v{{micro_editor_version}}/micro-{{micro_editor_version}}-linux64.tar.gz
    dest={{localinstallation}}/micro-{{micro_editor_version}}
  when: micro_directory|changed

- name: unpack micro
  shell: cd {{localinstallation}}/micro-{{micro_editor_version}} && tar xzf micro-{{micro_editor_version}}-linux64.tar.gz --strip-components 1
  when: micro_directory|changed

- name: symlink micro editor
  file: >
    src={{localinstallation}}/micro-{{micro_editor_version}}/micro
    dest={{ localinstallation }}/bin/micro
    state=link

- find: paths="{{localinstallation}}" patterns="micro-*" file_type=directory
  register: micro_installations

- name: remove old micro_installations
  file: path={{item.path}} state=absent
  when: item.path != "{{localinstallation}}/micro-{{micro_editor_version}}"
  with_items: "{{micro_installations.files}}"
