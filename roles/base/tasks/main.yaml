- lineinfile: dest=/etc/sysctl.d/10-magic-sysrq.conf state=present line="kernel.sysrq = 1" regexp="^kernel.sysrq.*"
  when: ansible_distribution == "Ubuntu"
  
- replace: dest=/etc/ssh/ssh_config replace="    AddressFamily inet" regexp="^#   AddressFamily.*"
  when: ansible_distribution == "Ubuntu"

- name: do ubuntu specific things
  block:
    - apt_repository:
        repo: "{{item}}"
        state: present
      with_items:
        - 'deb http://archive.ubuntu.com/ubuntu {{ansible_distribution_release}} multiverse'
        - 'deb-src http://archive.ubuntu.com/ubuntu {{ansible_distribution_release}} multiverse'
        - 'deb http://archive.ubuntu.com/ubuntu {{ansible_distribution_release}}-updates multiverse'
        - 'deb-src http://archive.ubuntu.com/ubuntu {{ansible_distribution_release}}-updates multiverse'
        - 'ppa:git-core/ppa'

    - name: google cloud packages
      apt_key: >
        url={{ google_cloud_url }}
        state=present

    - name: add key for dropbox
      apt_key: >
        keyserver={{ dropbox_keyserver }}
        id={{ dropbox_key }}
        state=present

    - name: add key for docker
      apt_key: >
        url={{ docker_key_url }}
        state=present

    - name: add key for google chrome
      apt_key: >
        url={{ chrome_key_url }}
        state=present

    - name: add key for packagecloud
      apt_key: >
        url={{ packagecloud_key_url }}
        state=present

    - name: activate addons apt sources
      template: src=addons.list.j2 dest=/etc/apt/sources.list.d/addons.list
      register: newsources

    - apt: update_cache=yes
      when: newsources is changed

    - name: install base packages
      apt: name={{item}} state=present
      with_items:
        - "{{base_packages}}"
  when: ansible_distribution == "Ubuntu"
  
- name: do fedora specific things
  block:
    - name: install some repos
      copy: src={{item}} dest=/etc/yum.repos.d/{{item | basename }}
      with_fileglob: 
        - "*.repo"
      
    - name: install base packages
      dnf: name={{item}} state=present
      with_items: "{{fedora_packages}}"
      
  when: ansible_distribution == "Fedora"
